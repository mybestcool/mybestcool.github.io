<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>以太坊白皮书学习记录 | 致良知</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Lucus Gu">
  
  
    <meta name="description" content="比特币的核心概念作为状态转换系统的比特币
转换函数
 1APPLY(S,TX) ­&amp;gt; S&amp;apos; or ERROR

转换函数解析：
交易的每个输入：
如果引用的UTXO不存在于现在的状态中（S），返回错误提示
如果签名与UTXO所有者的签名不一致，返回错误提示


如果所有的UTXO输入面值总额小于所有的UTXO输出面值总额，返回错误提示
返回新状态S’,新状态S’中移除了所有的输入U">
  
  <meta name="description" content="比特币的核心概念作为状态转换系统的比特币 转换函数  1APPLY(S,TX) ­&amp;gt; S&amp;apos; or ERROR  转换函数解析： 交易的每个输入： 如果引用的UTXO不存在于现在的状态中（S），返回错误提示 如果签名与UTXO所有者的签名不一致，返回错误提示   如果所有的UTXO输入面值总额小于所有的UTXO输出面值总额，返回错误提示 返回新状态S’,新状态S’中移除了所有的输入U">
<meta property="og:type" content="article">
<meta property="og:title" content="以太坊白皮书学习记录">
<meta property="og:url" content="https://mybestcool.github.io/2018/04/17/ethereum-wp/index.html">
<meta property="og:site_name" content="致良知">
<meta property="og:description" content="比特币的核心概念作为状态转换系统的比特币 转换函数  1APPLY(S,TX) ­&amp;gt; S&amp;apos; or ERROR  转换函数解析： 交易的每个输入： 如果引用的UTXO不存在于现在的状态中（S），返回错误提示 如果签名与UTXO所有者的签名不一致，返回错误提示   如果所有的UTXO输入面值总额小于所有的UTXO输出面值总额，返回错误提示 返回新状态S’,新状态S’中移除了所有的输入U">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-04-17T14:26:51.089Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="以太坊白皮书学习记录">
<meta name="twitter:description" content="比特币的核心概念作为状态转换系统的比特币 转换函数  1APPLY(S,TX) ­&amp;gt; S&amp;apos; or ERROR  转换函数解析： 交易的每个输入： 如果引用的UTXO不存在于现在的状态中（S），返回错误提示 如果签名与UTXO所有者的签名不一致，返回错误提示   如果所有的UTXO输入面值总额小于所有的UTXO输出面值总额，返回错误提示 返回新状态S’,新状态S’中移除了所有的输入U">
  
    <link rel="alternate" href="/atom.xml" title="致良知" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">致良知</a></h1>
    <p><a href="/">知行合一</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2018/04/17/ethereum-wp/">
  <time datetime="2018-04-17T14:26:01.000Z">
    2018-04-17
  </time>
</a>
    
    
  
    <h1 class="title">以太坊白皮书学习记录</h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="比特币的核心概念"><a href="#比特币的核心概念" class="headerlink" title="比特币的核心概念"></a>比特币的核心概念</h2><h3 id="作为状态转换系统的比特币"><a href="#作为状态转换系统的比特币" class="headerlink" title="作为状态转换系统的比特币"></a>作为状态转换系统的比特币</h3><ol>
<li><p>转换函数</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">APPLY(S,TX) ­&gt; S&apos; or ERROR</span><br></pre></td></tr></table></figure>
<ul>
<li>转换函数解析：<ol>
<li>交易的每个输入：<ul>
<li>如果引用的UTXO不存在于现在的状态中（S），返回错误提示</li>
<li>如果签名与UTXO所有者的签名不一致，返回错误提示</li>
</ul>
</li>
<li>如果所有的UTXO输入面值总额小于所有的UTXO输出面值总额，返回错误提示</li>
<li>返回新状态S’,新状态S’中移除了所有的输入UTXO，增加了所有的输出UTXO</li>
</ol>
</li>
</ul>
</li>
<li><p>状态结构（UTXO:未花费的交易输出，unspent transaction outputs）,包含一个面值和所有者（由20个字节的本质上是密码学公钥的地址所定义[1]）。一笔交易包括一个或多个输入和一个或多个输出。每个输入包含一个对现有UTXO的引用和由与所有者地址相对应的私钥创建的密码学签名。每个输出包含一个新的加入到状态中的UTXO。</p>
</li>
</ol>
<h3 id="挖矿"><a href="#挖矿" class="headerlink" title="挖矿"></a>挖矿</h3><ol>
<li>区块<ol>
<li>网络中的节点不断尝试把交易结果打包成“区块”</li>
<li>区块大约每十分钟产生一块</li>
<li>每个区块包含：时间戳、随机数、对上一个区块的引用（即hash值）、上一区块生成以来发生的所有交易列表。核对规则如下：<ul>
<li>检查区块引用的上一个区块是否存在且有效</li>
<li>检查区块的时间戳是否晚于以前的区块的时间戳，而且早于未来2小时</li>
<li>检查区块的工作量证明是否有效</li>
<li>将上一个区块的最终状态赋于S[0]</li>
<li>假设TX是区块的交易列表，包含n笔交易。对于属于0……n-1的所有i,进行状态转换S[i+1] = APPLY(S[i],TX[i])。如果任何一笔交易i在状态转换中出错，退出程序，返回错误。</li>
<li>返回正确，状态S[n]是这一区块的最终状态</li>
</ul>
</li>
</ol>
</li>
<li>矿工的作用和奖励<ol>
<li>使用共识算法“工作量证明”，即不停的创建区块，并设置区块的随机值等随机手段，然后hash这个区块，得出hash值是否小于2^190(190是随着比特币的增长，不断变小的值)，即为创建区块成功。创建区块者可以得到25BTC的奖励</li>
<li>矿工将交易打包到区块链。交易中的输入往往大于输出，差额部分就作为“交易费用”付给矿工。</li>
</ol>
</li>
</ol>
<h3 id="默克尔树"><a href="#默克尔树" class="headerlink" title="默克尔树"></a>默克尔树</h3><ol>
<li>定义：默克尔树是一种二叉树，由一组叶节点、一组中间节点和一个根节点构成。最下面的大量的叶节点包含基础数据，每个中间节点是它的两个子节点的哈希，根节点也是由它的两个子节点的哈希，代表了默克尔树的顶部。</li>
<li>特点：允许区块的数据可以零散地传送。节点可以从一个源下载区块头，从另外的源下载与其有关的树的其它部分，而依然能够确认所有的数据都是正确的</li>
</ol>
<h3 id="比特币智能合约的问题"><a href="#比特币智能合约的问题" class="headerlink" title="比特币智能合约的问题"></a>比特币智能合约的问题</h3><ol>
<li>缺少图灵完备</li>
<li>价值盲</li>
<li>缺少状态</li>
<li>区块链盲</li>
</ol>
<h2 id="以太坊的核心概念"><a href="#以太坊的核心概念" class="headerlink" title="以太坊的核心概念"></a>以太坊的核心概念</h2><h3 id="以太坊账户"><a href="#以太坊账户" class="headerlink" title="以太坊账户"></a>以太坊账户</h3><ol>
<li>以太坊状态：是由被称为“账户”的对象和在两个帐号之间转移价值和信息的状态转换构成</li>
<li>以太坊账户包含四个部分：<ol>
<li>随机数，用于确定每笔交易只能被处理一次的计数器</li>
<li>账户目前的以太币余额</li>
<li>账户的合约代码，如果有的话</li>
<li>账户的存储，默认为空</li>
</ol>
</li>
<li>分成两类账户：外部所有账户（私钥控制）、合约账户（合约代码控制）</li>
</ol>
<h3 id="消息和交易"><a href="#消息和交易" class="headerlink" title="消息和交易"></a>消息和交易</h3><ol>
<li>消息，类似于比特币的交易，但有三点不同<ol>
<li>以太坊的消息可以由外部实体或者合约创建，然而比特币的交易只能从外部创建</li>
<li>以太坊消息可以选择包含数据</li>
<li>如果以太坊消息的接受者是合约账户，可以选择进行回应，这意味着以太坊消息也包含函数概念</li>
</ol>
</li>
<li>交易是指存储的从外部账户发出的消息的签名数据包，包含<ol>
<li>消息的接收者</li>
<li>用于确认发送者的签名</li>
<li>发送者给接收者的以太币数量</li>
<li>一个可选的数据字段</li>
<li>STARTGAS值</li>
<li>GASPRICE值</li>
</ol>
</li>
<li>创建合约有单独的交易类型和相应的消息类型；合约的地址是基于账号随机数和交易数据的哈希计算出来的</li>
</ol>
<h3 id="以太坊状态转换函数"><a href="#以太坊状态转换函数" class="headerlink" title="以太坊状态转换函数"></a>以太坊状态转换函数</h3><ol>
<li><p>状态转换函数</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">APPLY(S,TX) ­&gt; S&apos; or ERROR</span><br></pre></td></tr></table></figure>
<ul>
<li>转换函数解析：<ol>
<li>检查交易的格式是否正确（即有正确数值）、签名是否有效和随机数是否与发送者账户的随机数匹配。如否，返回错误</li>
<li>计算交易费用:fee=STARTGAS * GASPRICE，并从签名中确定发送者的地址。从发送者的账户中减去交易费用和增加发送者的随机数。如果账户余额不足，返回错误</li>
<li>设定初值GAS = STARTGAS，并根据交易中的字节数减去一定量的瓦斯值</li>
<li>从发送者的账户转移价值到接收者账户。如果接收账户还不存在，创建此账户。如果接收账户是一个合约，运行合约的代码，直到代码运行结束或者瓦斯用完。</li>
<li>如果因为发送者账户没有足够的钱或者代码执行耗尽瓦斯导致价值转移失败，恢复原来的状态，但是还需要支付交易费用，交易费用加至矿工账户。</li>
<li>否则，将所有剩余的瓦斯归还给发送者，消耗掉的瓦斯作为交易费用发送给矿工</li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h3><ol>
<li>以太坊虚拟机：EVM</li>
<li>可以访问三种数据空间：堆栈、内存、合约的长期存储</li>
</ol>
<h3 id="区块链和挖矿"><a href="#区块链和挖矿" class="headerlink" title="区块链和挖矿"></a>区块链和挖矿</h3><ol>
<li>每个区块：不仅包含交易记录和最近的状态，还包含区块序号和难度值。核对规则如下<ol>
<li>检查区块引用的上一个区块是否存在和有效</li>
<li>检查区块的时间戳是否比引用的上一个区块大，而且小于15分钟</li>
<li>检查区块序号、难度值、 交易根，叔根和瓦斯限额（许多以太坊特有的底层概念）是否有效</li>
<li>检查区块的工作量证明是否有效</li>
<li>将S[0]赋值为上一个区块的STATE_ROOT</li>
<li>将TX赋值为区块的交易列表，一共有n笔交易。对于属于0……n-1的i，进行状态转换S[i+1] = APPLY(S[i],TX[i])。如果任何一个转换发生错误，或者程序执行到此处所花费的瓦斯（gas）超过了GASLIMIT，返回错误。</li>
<li>用S[n]给S_FINAL赋值, 向矿工支付区块奖励</li>
<li>检查S_FINAL是否与STATE_ROOT相同。如果相同，区块是有效的。否则，区块是无效的</li>
</ol>
</li>
<li>矿工的奖励，同比特币</li>
</ol>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><ol>
<li>代币系统</li>
<li>金融衍生品和价值稳定的货币</li>
<li>身份和信誉系统</li>
<li>去中心化存储</li>
<li>去中心化资质组织</li>
<li>其他<ol>
<li>储蓄钱包</li>
<li>作物保险</li>
<li>一个去中心化的数据发布器</li>
<li>云计算</li>
<li>点对点赌博</li>
<li>预测市场</li>
<li>链上去中心化市场</li>
</ol>
</li>
</ol>

    
  </div>
  <footer>
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2018 <a href="/">Lucus Gu</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>